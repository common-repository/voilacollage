/**
 * Voilà!Collage embed block
 *
 * Just a hacky clone of oEmbed block with a custom title and icon
 *
 */
( function( blocks, i18n, element, _ ) {

	var timeout = 1000;

	function tryToRegister() {
		var config = _.cloneDeep(blocks.getBlockType('core/embed'));

		if (!config) {
			setTimeout(tryToRegister, timeout);
			timeout *= 2;
			return;
		}


		var el = element.createElement;

		delete config.name;

		config.title = 'Voilà!Collage';

		config.icon = el('svg', { width: 24, height: 24 },
			el('path', {
				d: `M24,17c0,-2.26 0,-7.74 0,-10c0,-0.53 -0.211,-1.039 -0.586,-1.414c-0.375,-0.375 -0.884,-0.586 -1.414,-0.586c-3.665,0 -16.335,0 -20,0c-0.53,0 -1.039,0.211 -1.414,0.586c-0.375,0.375 -0.586,0.884 -0.586,1.414c0,2.26 0,7.74 0,10c0,0.53 0.211,1.039 0.586,1.414c0.375,0.375 0.884,0.586 1.414,0.586c3.665,0 16.335,0 20,0c0.53,0 1.039,-0.211 1.414,-0.586c0.375,-0.375 0.586,-0.884 0.586,-1.414l0,0Zm-22,-10l20,0c0,0 0,10 0,10l-20,0l0,-10Zm5.258,5.862l1.183,-2.975c0.081,-0.205 0.123,-0.395 0.123,-0.571c0,-0.107 -0.021,-0.192 -0.084,-0.247c-0.078,-0.067 -0.199,-0.088 -0.357,-0.088l-0.56,0l0,-0.931l3.153,0l0,0.931l-0.45,0c-0.109,0 -0.206,0.04 -0.292,0.115c-0.114,0.099 -0.216,0.281 -0.32,0.536l-2.398,5.926l-0.889,0c0,0 -2.574,-6.216 -2.575,-6.218c-0.058,-0.144 -0.114,-0.248 -0.189,-0.295c-0.08,-0.05 -0.212,-0.064 -0.391,-0.064l-0.394,0l0,-0.931l3.858,0l0,0.931l-0.616,0c-0.185,0 -0.31,0.002 -0.37,0.038l-0.001,0.001c0.007,0.057 0.038,0.142 0.084,0.256l1.485,3.586Zm5.254,0.573c0.281,0.006 0.52,0.11 0.717,0.311c0.202,0.207 0.303,0.455 0.303,0.746c0,0.291 -0.101,0.539 -0.303,0.746c-0.204,0.207 -0.451,0.311 -0.74,0.311c-0.288,0 -0.535,-0.103 -0.741,-0.311c-0.204,-0.206 -0.306,-0.455 -0.306,-0.746c0,-0.291 0.101,-0.54 0.303,-0.746c0.204,-0.208 0.45,-0.311 0.74,-0.311l0.027,0Zm6.951,-4.997l0.259,-0.55l0.741,0l0.137,3.25l-0.899,0l-0.035,-0.209c-0.122,-0.73 -0.345,-1.276 -0.685,-1.63c-0.316,-0.329 -0.675,-0.498 -1.081,-0.498c-0.438,0 -0.796,0.216 -1.083,0.633c-0.319,0.464 -0.466,1.198 -0.466,2.198c0,1.064 0.164,1.856 0.516,2.369c0.253,0.363 0.629,0.538 1.121,0.538c0.512,0 0.943,-0.189 1.291,-0.564c0.262,-0.284 0.437,-0.706 0.542,-1.259l0.038,-0.204l0.908,0l-0.036,0.281c-0.107,0.848 -0.434,1.516 -0.974,2.009c-0.544,0.496 -1.212,0.747 -2.005,0.747c-1.012,0 -1.86,-0.358 -2.544,-1.071c-0.679,-0.709 -1.023,-1.614 -1.023,-2.72c0,-1.227 0.397,-2.204 1.179,-2.936c0.673,-0.63 1.461,-0.943 2.365,-0.943c0.361,0 0.697,0.057 1.006,0.17c0.23,0.084 0.473,0.213 0.728,0.389Zm-6.561,4.739l0,-0.247c0,-0.41 0.02,-0.547 0.06,-0.846c0.041,-0.307 0.151,-0.856 0.328,-1.649c0.161,-0.72 0.238,-1.176 0.238,-1.366c0,-0.353 -0.101,-0.635 -0.287,-0.848c-0.199,-0.228 -0.453,-0.342 -0.761,-0.342c-0.311,0 -0.566,0.114 -0.765,0.339c-0.186,0.211 -0.287,0.497 -0.287,0.865c0,0.226 0.074,0.674 0.229,1.344c0.18,0.772 0.292,1.317 0.336,1.635c0.044,0.311 0.066,0.459 0.066,0.872l0,0.253l0.843,-0.01Z`
			})
		);

		blocks.registerBlockType( 'voilacollage/voilacollage-embed', config);
	}

	tryToRegister();

} )( window.wp.blocks, window.wp.i18n, window.wp.element, window.lodash );
